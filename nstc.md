Device: cuda
==========================================================================================
  NSCT v15 — Progressive Entity Refinement
==========================================================================================

  v14 lesson: injection ep MUST be contrastively supervised.
    Separate heads → unsupervised early head → negative scale → disaster.

  v15 approach: SAME EntityProjection head applied TWICE.
    After block 0: ep₀ (rough) → inject into block 1
    After block 1: ep₁ (refined, entity-bootstrapped) → inject into block 2
    Contrastive + binding on ep₁

  ep₁ advantages over v13's single ep:
    - 2 blocks of context (vs 1)
    - Block 1 was entity-aware → better class separation in h₁
    - Contrastive gradients train BOTH applications of the shared head

  Also testing v13-late: inject after block 1 (simpler, 1 injected block)

  5 models × 2 tasks:
    Vanilla            — baseline
    v9 (contr+bind)    — ep after all blocks, no injection
    v13 (inject@0)     — ep after block 0, inject blocks 1-2
    v13-late (inj@1)   — ep after block 1, inject block 2
    v15 (progressive)  — ep₀ after block 0, ep₁ after block 1, both inject

  Historical bests:
    v9:  comp 81.2%, hop 60-72%
    v13: comp 75.7%, hop 72-75%

==========================================================================================
  Compositional (8 classes, guaranteed same-class)
==========================================================================================
  Vocab: 89  |  Max Entities: 8  |  Chance: 2.5%  |  Guarantee: True

──────────────────────────────────────────────────────────────────────────────────────────
  Vanilla  (162,752 params)  [inject=none]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST
  ──────  ────────  ────────  ────────
       1    4.7616     4.56%     3.94%
     500    0.5913    87.53%    33.22%
    1000    0.0189   100.00%    54.97%
    1500    0.0062   100.00%    59.59%
    2000    0.0036   100.00%    61.62%
    2500    0.0022   100.00%    63.72%
    3000    0.0014   100.00%    63.25%
    3500    0.0013   100.00%    64.31%
    4000    0.0009   100.00%    63.53%
    4500    0.0009   100.00%    63.62%
    5000    0.0008   100.00%    65.25%
    5500    0.0008   100.00%    66.62%
    6000    0.0007   100.00%    66.41%

  Final — Train: 100.00%  |  Test: 66.06%  (best: 66.62%)

──────────────────────────────────────────────────────────────────────────────────────────
  v9 (contr+bind)  (167,561 params)  [inject=none]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive
  ──────  ────────  ────────  ────────  ───────  ──────  ──────
       1    4.5969     1.72%     0.97%   1.0943   0.269    8.00
     500    0.8160    84.88%    44.34%   0.1991   0.260    4.86
    1000    0.0232   100.00%    67.59%   0.2320   0.248    4.14
    1500    0.0062   100.00%    74.09%   0.1772   0.246    4.42
    2000    0.0046   100.00%    73.78%   0.1408   0.245    4.11
    2500    0.0022   100.00%    78.03%   0.1792   0.244    4.25
    3000    0.0016   100.00%    78.91%   0.2629   0.243    4.31
    3500    0.0014   100.00%    78.69%   0.1658   0.242    4.36
    4000    0.0009   100.00%    81.19%   0.2851   0.242    4.06
    4500    0.0010   100.00%    80.25%   0.1933   0.241    4.12
    5000    0.0009   100.00%    80.16%   0.1966   0.241    4.22
    5500    0.0009   100.00%    79.75%   0.1899   0.241    4.30
    6000    0.0007   100.00%    80.34%   0.2354   0.240    4.16

  Final — Train: 100.00%  |  Test: 79.53%  (best: 81.19%)

──────────────────────────────────────────────────────────────────────────────────────────
  v13 (inject@0)  (167,563 params)  [inject=after0]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive   inj_s
  ──────  ────────  ────────  ────────  ───────  ──────  ──────  ──────
       1    4.7134     0.03%     0.00%   1.0959   0.269    8.00   0.000
     500    0.6795    85.16%    42.19%   0.2312   0.258    5.33   0.045
    1000    0.0192   100.00%    63.81%   0.1446   0.252    5.95   0.050
    1500    0.0079   100.00%    68.81%   0.0992   0.252    5.98   0.053
    2000    0.0037   100.00%    69.25%   0.1271   0.252    5.92   0.055
    2500    0.0020   100.00%    73.38%   0.1329   0.252    5.72   0.057
    3000    0.0016   100.00%    72.25%   0.1098   0.252    5.95   0.058
    3500    0.0013   100.00%    70.88%   0.1440   0.252    5.78   0.059
    4000    0.0010   100.00%    75.03%   0.1212   0.252    5.92   0.059
    4500    0.0009   100.00%    73.19%   0.1722   0.252    5.81   0.060
    5000    0.0007   100.00%    75.72%   0.1001   0.252    5.97   0.060
    5500    0.0007   100.00%    74.31%   0.2279   0.252    5.73   0.061
    6000    0.0006   100.00%    73.50%   0.0876   0.252    5.66   0.061

  Final — Train: 100.00%  |  Test: 75.20%  (best: 75.72%)

──────────────────────────────────────────────────────────────────────────────────────────
  v13-late (inj@1)  (167,562 params)  [inject=after1]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive   inj_s
  ──────  ────────  ────────  ────────  ───────  ──────  ──────  ──────
       1    4.6472     8.34%     5.38%   1.0899   0.269    8.00   0.000
     500    0.7049    83.06%    42.88%   0.2230   0.258    5.62   0.015
    1000    0.0243   100.00%    64.84%   0.2131   0.254    5.92   0.039
    1500    0.0077   100.00%    70.16%   0.1065   0.254    5.95   0.041
    2000    0.0038   100.00%    76.31%   0.1571   0.254    5.84   0.041
    2500    0.0026   100.00%    75.88%   0.1329   0.254    6.00   0.041
    3000    0.0019   100.00%    77.25%   0.0851   0.254    5.70   0.040
    3500    0.0013   100.00%    78.53%   0.1569   0.254    6.08   0.040
    4000    0.0011   100.00%    79.47%   0.1729   0.254    5.84   0.040
    4500    0.0010   100.00%    81.56%   0.1386   0.254    5.92   0.040
    5000    0.0009   100.00%    81.16%   0.1444   0.254    5.94   0.040
    5500    0.0009   100.00%    80.12%   0.0600   0.254    5.88   0.040
    6000    0.0007   100.00%    81.88%   0.1393   0.254    5.83   0.040

  Final — Train: 100.00%  |  Test: 81.30%  (best: 81.88%)

──────────────────────────────────────────────────────────────────────────────────────────
  v15 (progressive)  (167,563 params)  [inject=progressive]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive   inj_s
  ──────  ────────  ────────  ────────  ───────  ──────  ──────  ──────
       1    4.3271     2.59%     0.38%   1.1067   0.269    8.00   0.000
     500    0.8470    80.88%    33.16%   0.2533   0.263    6.11   0.070
    1000    0.0277   100.00%    55.19%   0.2059   0.262    6.00   0.104
    1500    0.0067   100.00%    62.03%   0.2154   0.262    5.59   0.149
    2000    0.0036   100.00%    66.59%   0.1408   0.262    5.61   0.200
    2500    0.0021   100.00%    68.22%   0.1426   0.262    5.64   0.231
    3000    0.0020   100.00%    67.78%   0.0745   0.262    5.62   0.255
    3500    0.0016   100.00%    67.81%   0.1117   0.262    5.58   0.299
    4000    0.0013   100.00%    69.97%   0.1098   0.262    5.89   0.322
    4500    0.0011   100.00%    72.50%   0.1637   0.262    5.58   0.333
    5000    0.0008   100.00%    70.50%   0.1113   0.262    5.77   0.339
    5500    0.0008   100.00%    72.00%   0.1417   0.262    5.62   0.343
    6000    0.0007   100.00%    73.00%   0.0500   0.262    5.56   0.346

  Final — Train: 100.00%  |  Test: 72.25%  (best: 73.00%)

──────────────────────────────────────────────────────────────────────────────────────────
  SUMMARY — Compositional (8 classes, guaranteed same-class)
──────────────────────────────────────────────────────────────────────────────────────────
  Model                       Params    Train     Test     Best
  ────────────────────────  ────────  ───────  ───────  ───────
  Vanilla                    162,752   100.0%    66.1%    66.6%
  v9 (contr+bind)            167,561   100.0%    79.5%    81.2%
  v13 (inject@0)             167,563   100.0%    75.2%    75.7%
  v13-late (inj@1)           167,562   100.0%    81.3%    81.9%
  v15 (progressive)          167,563   100.0%    72.2%    73.0%

  Δ vs Vanilla (best test):
    ✓ v9 (contr+bind)       : +14.56%
    ✓ v13 (inject@0)        : +9.09%
    ✓ v13-late (inj@1)      : +15.25%
    ✓ v15 (progressive)     : +6.37%

  Δ v13 (inject@0) vs v9: -5.47%  ✗

  Δ v13-late (inj@1) vs v9: +0.69%  ~

  Δ v15 (progressive) vs v9: -8.19%  ✗

==========================================================================================
  Multi-Hop (5 classes, guaranteed same-class)
==========================================================================================
  Vocab: 65  |  Max Entities: 8  |  Chance: 10.0%  |  Guarantee: True

──────────────────────────────────────────────────────────────────────────────────────────
  Vanilla  (159,680 params)  [inject=none]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST
  ──────  ────────  ────────  ────────
       1    4.2735     0.00%     0.00%
     500    0.0077   100.00%    43.31%
    1000    0.0024   100.00%    41.59%
    1500    0.0012   100.00%    39.81%
    2000    0.0008   100.00%    40.56%
    2500    0.0005   100.00%    40.81%
    3000    0.0004   100.00%    40.78%
    3500    0.0003   100.00%    40.22%
    4000    0.0002   100.00%    40.06%
    4500    0.0002   100.00%    39.25%
    5000    0.0002   100.00%    38.81%
    5500    0.0002   100.00%    38.88%
    6000    0.0001   100.00%    37.69%

  Final — Train: 100.00%  |  Test: 39.31%  (best: 43.31%)

──────────────────────────────────────────────────────────────────────────────────────────
  v9 (contr+bind)  (164,489 params)  [inject=none]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive
  ──────  ────────  ────────  ────────  ───────  ──────  ──────
       1    4.6452     0.00%     0.00%   0.6854   0.269    8.00
     500    0.0081   100.00%    54.94%   0.0976   0.266    4.00
    1000    0.0025   100.00%    56.22%   0.1409   0.266    3.98
    1500    0.0012   100.00%    57.63%   0.1625   0.267    3.94
    2000    0.0008   100.00%    57.25%   0.0975   0.267    3.92
    2500    0.0005   100.00%    56.53%   0.1733   0.267    3.92
    3000    0.0004   100.00%    57.03%   0.0975   0.268    3.91
    3500    0.0003   100.00%    58.78%   0.1083   0.268    3.89
    4000    0.0002   100.00%    58.72%   0.1625   0.268    3.81
    4500    0.0002   100.00%    59.03%   0.1300   0.268    3.81
    5000    0.0002   100.00%    57.78%   0.1408   0.268    3.78
    5500    0.0002   100.00%    59.81%   0.1733   0.268    3.67
    6000    0.0001   100.00%    58.69%   0.1300   0.268    3.84

  Final — Train: 100.00%  |  Test: 59.20%  (best: 59.81%)

──────────────────────────────────────────────────────────────────────────────────────────
  v13 (inject@0)  (164,491 params)  [inject=after0]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive   inj_s
  ──────  ────────  ────────  ────────  ───────  ──────  ──────  ──────
       1    4.4810     0.00%     0.00%   0.6959   0.269    8.00   0.000
     500    0.0083   100.00%    57.84%   0.0980   0.264    4.95   0.040
    1000    0.0026   100.00%    58.44%   0.1301   0.264    4.34   0.039
    1500    0.0013   100.00%    58.03%   0.1084   0.264    3.92   0.039
    2000    0.0008   100.00%    58.94%   0.0976   0.264    3.97   0.040
    2500    0.0005   100.00%    60.22%   0.1950   0.264    3.83   0.039
    3000    0.0004   100.00%    58.31%   0.0975   0.265    3.89   0.040
    3500    0.0003   100.00%    59.75%   0.1950   0.265    3.84   0.040
    4000    0.0003   100.00%    58.19%   0.1517   0.265    3.89   0.040
    4500    0.0002   100.00%    61.00%   0.1408   0.265    3.86   0.040
    5000    0.0002   100.00%    60.38%   0.1517   0.265    3.86   0.040
    5500    0.0002   100.00%    58.22%   0.1084   0.265    3.81   0.040
    6000    0.0001   100.00%    59.13%   0.1625   0.265    3.81   0.040

  Final — Train: 100.00%  |  Test: 58.08%  (best: 61.00%)

──────────────────────────────────────────────────────────────────────────────────────────
  v13-late (inj@1)  (164,490 params)  [inject=after1]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive   inj_s
  ──────  ────────  ────────  ────────  ───────  ──────  ──────  ──────
       1    3.6832    19.72%    23.12%   0.6979   0.269    8.00   0.000
     500    0.0070   100.00%    53.81%   0.1630   0.266    4.06   0.031
    1000    0.0023   100.00%    53.81%   0.1301   0.266    3.86   0.034
    1500    0.0012   100.00%    55.56%   0.0976   0.266    3.88   0.037
    2000    0.0007   100.00%    57.50%   0.1950   0.267    3.73   0.038
    2500    0.0005   100.00%    55.84%   0.0867   0.267    3.83   0.040
    3000    0.0003   100.00%    55.88%   0.1192   0.267    3.77   0.041
    3500    0.0003   100.00%    56.88%   0.1517   0.267    3.73   0.042
    4000    0.0002   100.00%    55.25%   0.1625   0.267    3.72   0.042
    4500    0.0002   100.00%    57.34%   0.0650   0.267    3.84   0.043
    5000    0.0002   100.00%    56.62%   0.2058   0.267    3.67   0.043
    5500    0.0001   100.00%    55.62%   0.1300   0.268    3.75   0.044
    6000    0.0001   100.00%    57.53%   0.1517   0.268    3.75   0.044

  Final — Train: 100.00%  |  Test: 56.77%  (best: 57.53%)

──────────────────────────────────────────────────────────────────────────────────────────
  v15 (progressive)  (164,491 params)  [inject=progressive]
──────────────────────────────────────────────────────────────────────────────────────────
    step      loss     train      TEST   c_loss    gate   alive   inj_s
  ──────  ────────  ────────  ────────  ───────  ──────  ──────  ──────
       1    4.1460    15.12%     9.19%   0.6951   0.269    8.00   0.000
     500    0.0077   100.00%    56.53%   0.1413   0.265    6.17   0.007
    1000    0.0024   100.00%    57.72%   0.1517   0.265    5.38   0.008
    1500    0.0012   100.00%    61.22%   0.1084   0.265    4.97   0.010
    2000    0.0007   100.00%    61.09%   0.1950   0.265    4.84   0.010
    2500    0.0005   100.00%    62.00%   0.1409   0.265    4.61   0.011
    3000    0.0004   100.00%    61.44%   0.1192   0.266    4.33   0.012
    3500    0.0003   100.00%    60.84%   0.1192   0.266    4.41   0.012
    4000    0.0002   100.00%    62.31%   0.1300   0.266    4.38   0.012
    4500    0.0002   100.00%    61.94%   0.1083   0.266    4.38   0.013
    5000    0.0002   100.00%    62.28%   0.1408   0.266    4.16   0.013
    5500    0.0002   100.00%    63.00%   0.1517   0.266    4.28   0.013
    6000    0.0001   100.00%    63.25%   0.0975   0.266    4.22   0.013

  Final — Train: 100.00%  |  Test: 62.16%  (best: 63.25%)

──────────────────────────────────────────────────────────────────────────────────────────
  SUMMARY — Multi-Hop (5 classes, guaranteed same-class)
──────────────────────────────────────────────────────────────────────────────────────────
  Model                       Params    Train     Test     Best
  ────────────────────────  ────────  ───────  ───────  ───────
  Vanilla                    159,680   100.0%    39.3%    43.3%
  v9 (contr+bind)            164,489   100.0%    59.2%    59.8%
  v13 (inject@0)             164,491   100.0%    58.1%    61.0%
  v13-late (inj@1)           164,490   100.0%    56.8%    57.5%
  v15 (progressive)          164,491   100.0%    62.2%    63.2%

  Δ vs Vanilla (best test):
    ✓ v9 (contr+bind)       : +16.50%
    ✓ v13 (inject@0)        : +17.69%
    ✓ v13-late (inj@1)      : +14.22%
    ✓ v15 (progressive)     : +19.94%

  Δ v13 (inject@0) vs v9: +1.19%  ✓

  Δ v13-late (inj@1) vs v9: -2.28%  ✗

  Δ v15 (progressive) vs v9: +3.44%  ✓

==========================================================================================
  v15 FULL RESULTS
==========================================================================================

  Model                      Comp best    Hop best       Avg
  ────────────────────────  ──────────  ──────────  ────────
  Vanilla                       66.62%      43.31%    54.97%
  v9 (contr+bind)               81.19%      59.81%    70.50%
  v13 (inject@0)                75.72%      61.00%    68.36%
  v13-late (inj@1)              81.88%      57.53%    69.70%
  v15 (progressive)             73.00%      63.25%    68.12%

  Key questions:
  1. Does v15 recover comp? (v15 comp > v13 comp, closer to v9)
  2. Does v15 preserve hop? (v15 hop ≈ v13 hop)
  3. Does v15 beat v9 on average? (the main goal)
  4. Does later injection help? (v13-late vs v13)
  5. Do injection scales stay positive? (critical test)
  6. Does progressive beat the simpler alternatives?

  Historical reference:
    v9:   avg 70.9-76.8% (comp always ~81%, hop varies 60-72%)
    v13:  avg 73.9-75.4% (comp ~75%, hop 72-75%)
    Best ever single-run avg: v9 at 76.8% (v12 run)
==========================================================================================
